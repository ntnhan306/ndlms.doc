<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>LMS – Trường THCS Bến Tre</title>

<!-- Font Awesome (icon tải xuống) -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@onlyoffice/document-editor-web-apps@latest"></script>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  margin: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
  table-layout: auto;
}

th, td {
  border: 1px solid #444;
  padding: 8px;
}

th {
  background-color: #f2f2f2;
  text-align: center;
}

th.stt, td.stt {
  width: 1%;
  white-space: nowrap;
  text-align: center;
}

th.download, td.download {
  width: 1%;
  text-align: center;
}

th.preview, td.preview {
  width: 1%;
  text-align: center;
}

td.loai {
  width: 1%;
  white-space: nowrap;
  text-align: center;
}

td.download, td.preview {
  text-align: center;
}
      
td.download .wrap, td.preview .wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%; height: 100%;
}

/* Button chỉ có icon */
button.download-btn {
  width: 40px;
  height:40px;
  border-radius: 50%;
  background: none;
  border: 3px solid transparent;
  cursor: pointer;
  font-size: 18px;
  color: #2563eb;
  transition: 
    color 0.25s ease,
    transform 0.2s ease,
    border 0.2s ease,
    box-shadow 0.25s ease;
}

button.download-btn:hover {
  border: 3px #dc2626 solid;
  transform: scale(1.15);
  color: #dc2626;
}

button.download-btn:active {
  transform: scale(0.95);
}

button.preview-btn {
  width: 40px;
  height:40px;
  border-radius: 50%;
  background: none;
  border: 3px solid transparent;
  cursor: pointer;
  font-size: 18px;
  color: #2563eb;
  transition: 
    color 0.25s ease,
    transform 0.2s ease,
    border 0.2s ease,
    box-shadow 0.25s ease;
}

button.preview-btn:hover {
  border: 3px #dc2626 solid;
  transform: scale(1.15);
  color: #dc2626;
}

button.preview-btn:active {
  transform: scale(0.95);
}
</style>
</head>

<body>

<h2 style="text-align: center;">Nội dung LMS – Trường THCS Bến Tre</h2>
<p style="text-align: center;">Chia sẻ các tài liệu, đáp án các khoá học, kì thi trên hệ thống LMS của trường THCS Bến Tre.</p>

<table>
  <thead>
    <tr>
      <th class="stt">STT</th>
      <th>Loại</th>
      <th>Tên tài liệu</th>
      <th class="preview">Xem trước</th>
      <th class="download">Tải xuống</th>
    </tr>
  </thead>
  <tbody id="table-body">
    <!-- JS sẽ sinh dữ liệu tại đây -->
  </tbody>
</table>

<script>
/*
  data_table = [
    [Tên tài liệu, Tên file, Đường dẫn tải]
  ]
*/
const data_table = [
  ["Demo", "Demo TXT", "demo.txt"],
  ["Demo", "Demo MD", "demo.md"],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  // ["", "", ""],
  ["Đề có đáp án", "TIN HỌC 8 ÔN CKI", "CuoiKi1(25-26)-TinHoc/ONTAP.xlsx"],
  ["Đề có đáp án", "Kiểm tra thường xuyên Mĩ thuật 8- Hội họa Ấn tượng", "Kiem_tra_thuong_xuyen_Mi_thuat_8-_Hoi_hoa_An_tuong.pdf"],
  ["Đề có đáp án", "KTTX HOÁ 8 LẦN 2 BÀI 4 + 5", "KTTX_HOA_8_LAN_2_BAI_4.pdf"],
  ["Đề có đáp án", "ÔN TẬP CUỐI KÌ 1 CÔNG NGHỆ 8", "ON_TAP_CUOI_KI_1_CONG_NGHE_8.pdf"],
  ["Đề có đáp án", "TIN HỌC 25-26", "TIN_HOC_25-26.pdf"],
  ["Đề có đáp án", "KIỂM TRA TX PHÂN MÔN ĐỊA LÍ 8 (25-26)", "KIEM_TRA_TX_PHAN_MON_DIA_LI_8_(25-26).pdf"],
  ["Đề", "CÂU HỎI ÔN TẬP GIỮA KỲ 1 - MÔN KHTN 8 (VẬT LÝ)", "CAU_HOI_ON_TAP_GIUA_KY_1_-_MON_KHTN_8_(VAT_LY).pdf"],
  ["Đề có đáp án", "TRẮC NGHIỆM - ÔN TẬP GK1 - KHTN 8 (VẬT LÝ)", "TRAC_NGHIEM_-_ON_TAP_GK1_-_KHTN_8_(VAT_LY).DAPAN.pdf"],
  ["Đề", "TRẮC NGHIỆM - ÔN TẬP GK1 - KHTN 8 (VẬT LÝ)", "TRAC_NGHIEM_-_ON_TAP_GK1_-_KHTN_8_(VAT_LY).pdf"],
  ["Đề", "HỆ THỐNG MỘT SỐ CÂU HỎI ÔN TẬP KHTN 8 GKI – HOÁ", "HE_THONG_MOT_SO_CAU_HOI_ON_TAP_KHTN_8_GKI_-_HOA.pdf"],
  ["Đề", "HH-ÔN KTGK I - TOÁN 8- NĂM 25-26", "HH-ON_KTGK_I_-_TOAN_8-_NAM_25-26.pdf"],
  ["Đề", "ĐẠI SỐ - ÔN KTGK I-TOÁN 8 NĂM 25-26", "DS-ON_KTGK_I-TOAN_8_NAM_25-26.pdf"],
  ["Đề có đáp án", "ÔN TẬP KIỂM TRA GIỮA HỌC KỲ I LỊCH SỬ 8", "ON_TAP_KIEM_TRA_GIUA_HOC_KY_I_LICH_SU_8.DAPAN.pdf"],
  ["Đề", "ÔN TẬP KIỂM TRA GIỮA HỌC KỲ I LỊCH SỬ 8", "ON_TAP_KIEM_TRA_GIUA_HOC_KY_I_LICH_SU_8.pdf"],
  ["Đề có đáp án", "ÔN TẬP KIỂM TRA GIỮA HỌC KỲ I ĐỊA LÍ 8", "ON_TAP_KIEM_TRA_GIUA_HOC_KY_I_DIA_LI_8.DAPAN.pdf"],
  ["Đề", "ÔN TẬP KIỂM TRA GIỮA HỌC KỲ I ĐỊA LÍ 8", "ON_TAP_KIEM_TRA_GIUA_HOC_KY_I_DIA_LI_8.pdf"],
  ["Đề", "ÔN TẬP CHƯƠNG 1 - CÔNG NGHỆ 8", "ON_TAP_CHUONG_1_-_CONG_NGHE_8.pdf"],
  ["Đề", "Ôn tập GK 1 - Sinh 8</br>ÔN TẬP KHTN 8 (SINH) GK1 NH 25-26", "On_tap_GK_1_-_Sinh_8.pdf"],
  ["Đề", "ÔN TẬP GK I ANH 8</br>OTGKI T.Anh 8 - Cô NGọc Anh</br>ANH 8 ÔN TẬP GKI CAO HƯƠNG", "OTGKI_T.Anh_8_-_Co_NGoc_Anh.pdf"],
  ["Đề", "HƯỚNG DẪN ÔN TẬP KIỂM TRA GIỮA KỲ I MÔN GDCD 8 NH 25-26", "HUONG_DAN_ON_TAP_KIEM_TRA_GIUA_KY_I_MON_GDCD_8_NH_25-26.pdf"],
  ["Đề có đáp án", "BÀI TẬP - HƯỚNG DẪN ÔN TẬP KIỂM TRA GIỮA KỲ I MÔN GDCD 8 NH 25-26", "BAI_TAP_-_HUONG_DAN_ON_TAP_KIEM_TRA_GIUA_KY_I_MON_GDCD_8_NH_25-26.pdf"]
];

const tbody = document.getElementById("table-body");

data_table.forEach((item, index) => {
  const [loai, tenTaiLieu, link] = item;

  const tr = document.createElement("tr");

  tr.innerHTML = `
    <td class="stt">${index + 1}</td>
    <td class="loai">${loai}</td>
    <td>${tenTaiLieu}</td>
    <td class="preview">
      <div class="wrap">
        <button class="preview-btn" title="Xem trước" onclick="preview('${link}')">
          <i class="fa-solid fa-file-circle-question"></i>
        </button>
      </div>
    </td>
    <td class="download">
      <div class="wrap">
        <a href="${link}" download>
          <button class="download-btn" title="Tải xuống">
            <i class="fa-solid fa-download"></i>
          </button>
        </a>
      </div>
    </td>
  `;

  tbody.appendChild(tr);
});

function preview(path) {
  document.querySelector(".pv-overlay")?.remove();

  const fileName = decodeURIComponent(path.split("/").pop());
  const ext = fileName.split(".").pop().toLowerCase();

  const OFFICE = ["doc","docx","xls","xlsx","ppt","pptx"];
  const IMAGE  = ["png","jpg","jpeg","gif","webp"];
  const PDF    = ["pdf"];
  const TEXT   = ["txt"];

  const shortName = (n, max=42) => {
    if (n.length <= max) return n;
    const d = n.lastIndexOf(".");
    return n.slice(0, max-5) + "..." + n.slice(d);
  };

  /* ================= OVERLAY ================= */
  const overlay = document.createElement("div");
  overlay.className = "pv-overlay";
  overlay.innerHTML = `
  <div class="pv-box">
    <div class="pv-header">
      <span class="pv-title" title="${fileName}">${shortName(fileName)}</span>
      <button class="pv-close">✕</button>
    </div>

    <div class="pv-toolbar" id="toolbar"></div>
    <div class="pv-body" id="viewer"></div>
  </div>`;
  document.body.appendChild(overlay);

  /* ================= CSS ================= */
  if (!document.getElementById("pv-style")) {
    const style = document.createElement("style");
    style.id = "pv-style";
    style.textContent = `
    .pv-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:9999}
    .pv-box{width:95vw;height:85vh;bottom:2.5vh;background:#fff;border-radius:12px;display:flex;flex-direction:column;overflow:hidden;animation:pop .3s}
    .pv-header{height:48px;background:#0f172a;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 14px}
    .pv-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:80%}
    .pv-close{background:none;border:none;color:#fff;font-size:20px;cursor:pointer}
    .pv-toolbar{height:42px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:center;gap:8px}
    .pv-body{flex:1;overflow:auto;background:#f1f5f9;display:flex;justify-content:center}
    iframe{border:none;width:100%;height:100%}
    img{max-width:100%;max-height:100%;margin:auto}
    pre{white-space:pre-wrap;padding:20px}
    .pv-center{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px}
    @keyframes pop{from{transform:scale(.9);opacity:0}to{transform:1;opacity:1}}
    `;
    document.head.appendChild(style);
  }

  overlay.querySelector(".pv-close").onclick = () => overlay.remove();

  const viewer = overlay.querySelector("#viewer");
  const toolbar = overlay.querySelector("#toolbar");

  /* ================= PDF ================= */
  if (PDF.includes(ext)) {
    toolbar.innerHTML = `
      <button id="z-" style="width:32px;height:32px;border:none;border-radius:6px;background:#e5e7eb;cursor:pointer;font-size:18px">−</button>

      <input id="zv" type="number" value="100" min="10" max="400"
        style="width:70px;height:32px;text-align:center;border:1px solid #cbd5f1;border-radius:6px;font-weight:600">%

      <button id="z+" style="width:32px;height:32px;border:none;border-radius:6px;background:#e5e7eb;cursor:pointer;font-size:18px">+</button>

      <span style="margin-left:12px;display:flex;align-items:center;gap:4px">
        <input id="pg" type="number" min="1" value="1"
          style="width:60px;height:32px;text-align:center;border:1px solid #cbd5f1;border-radius:6px">
        / <span id="tp">?</span>
      </span>
    `;

    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

    let scale = 1;
    let pdfDoc;
    const canvases = [];

    const box = document.createElement("div");
    box.style.padding = "20px";
    box.style.display = "flex";
    box.style.flexDirection = "column";
    box.style.gap = "20px";
    viewer.appendChild(box);

    pdfjsLib.getDocument(path).promise.then(pdf => {
      pdfDoc = pdf;
      toolbar.querySelector("#tp").textContent = pdf.numPages;

      for (let i = 1; i <= pdf.numPages; i++) {
        const c = document.createElement("canvas");
        c.dataset.page = i;
        box.appendChild(c);
        canvases.push(c);
        renderPage(i, c);
      }
    });

    function renderPage(num, canvas) {
      pdfDoc.getPage(num).then(page => {
        const viewport = page.getViewport({ scale });
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        page.render({ canvasContext: canvas.getContext("2d"), viewport });
      });
    }

    function setZoom(z) {
      scale = Math.min(Math.max(z, 0.1), 4);
      toolbar.querySelector("#zv").value = Math.round(scale * 100);
      canvases.forEach(c => renderPage(c.dataset.page, c));
    }

    toolbar.querySelector("#z+").onclick = () => setZoom(scale + 0.1);
    toolbar.querySelector("#z-").onclick = () => setZoom(scale - 0.1);
    toolbar.querySelector("#zv").onchange = e => setZoom(e.target.value / 100);

    viewer.addEventListener("scroll", () => {
      let cur = 1;
      canvases.forEach(c => {
        if (c.offsetTop <= viewer.scrollTop + 10) cur = c.dataset.page;
      });
      toolbar.querySelector("#pg").value = cur;
    });

    toolbar.querySelector("#pg").onchange = e => {
      const t = canvases[e.target.value - 1];
      t && viewer.scrollTo({ top: t.offsetTop - 10, behavior: "smooth" });
    };
    return;
  }

  /* ================= OFFICE ================= */
  if (OFFICE.includes(ext)) {
    toolbar.innerHTML = "<strong>Office document preview</strong>";
    viewer.innerHTML = `
      <iframe src="https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(location.origin + "/" + path)}"></iframe>
    `;
    return;
  }

  /* ================= IMAGE ================= */
  if (IMAGE.includes(ext)) {
    toolbar.innerHTML = "";
    viewer.innerHTML = `<img src="${path}">`;
    return;
  }

  /* ================= TEXT ================= */
  if (TEXT.includes(ext)) {
    fetch(path).then(r => r.text()).then(t => {
      viewer.innerHTML = `<pre>${t.replace(/</g,"&lt;")}</pre>`;
    });
    return;
  }

  /* ================= UNSUPPORTED ================= */
  viewer.innerHTML = `
    <div class="pv-center">
      <strong>File này không được hỗ trợ hoặc bị lỗi!</strong>
      <a href="${path}" download style="color:#2563eb">⬇ Tải về máy</a>
    </div>
  `;
}
</script>
</body>
</html>
